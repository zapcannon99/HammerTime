<%- include("../partials/head", {title: "HammerTime", css: ["show.css"]})%>
<%- include("../partials/navbar") %>


<div id="data" class="hidden"
data-listing="<%= JSON.stringify(listing) %>">
</div>

<div class="row">
	<div id="gallery" class="col col-5">
		<img id="picture" class="display-img" src="/images/db/<%= listing.pictures[0] %>" />
		<div id="gallery-nav">
			<button id="previous" class="btn btn-primary">
				<i class="fa fa-arrow-circle-left" style="font-size:18px"></i>
			</button>
			<button id="photo-delete" class="btn btn-danger">
				Remove Photo
			</button>
			<button id="next" class="btn btn-primary">
				<i class="fa fa-arrow-circle-right" style="font-size:18px"></i>
			</button>
		</div>
		<div>
			<form id="photo-form" action="javascript:void(0);" enctype="multipart/form-data">
				<input type='file' id='added-photos' name='added-photos' multiple="multiple">
				<input type='submit' value="Upload Photos"></input>
			</form>
		</div>
		<div>
			<p>Changes to photos are saved immediately</p>
		</div>
	</div>
	<div class="col col-7 parent border-left pad">
		<form id='text-edits-form' action='/listings/<%=listing._id%>?_method=PUT' method="POST">
			<div class="row">
				<div class="title">Title: <input type='text' name='title' value='<%= listing.title %>' ></div>
			</div>
			<div class="row">
				<label for="category">Category: </label>
				<select class="" id="category" name="category">
					<option></option>
					<% var categories = ['Apparel', 'Beauty', 'Books', 'Camera', 'Cell Phones', 'Collectables', 'Jewelry', 'Fine Art', 'Handmade', 'Health', 'Music', 'Music Instruments', 'Office', 'Outdoors', 'Software', 'Video Games', 'Board Games', 'Toys', 'Sports', 'Tools', 'Videos']; 
					categories.sort();
					categories.forEach((category) => { 
						var selected = "";
						if(category == listing.category) {
							selected = "selected";
						} %>
						<option value="<%= category %>" <%= selected %>><%= category %></option>
					<% }) %>
				</select>
			</div>
			<div class="row">
				<label for="condition">Condition: </label>
				<select class="" id="condition" name="condition">
					<option></option>
					<% var conditions = ['New', 'Like New', 'Used', 'Scrap']; 
					conditions.sort();
					conditions.forEach((condition) => { 
						var selected = "";
						if(condition == listing.condition) {
							selected = "selected";
						} %>
						<option value="<%= condition %>" <%= selected %>><%= condition %></option>
					<% }) %>
				</select>
			</div>

			<div class = "row border-bottom">
				<div>
					<h3>Current Bid: <strong>$</strong><strong id='current-bid'><%= currentBid %></strong></h3>
				</div>
			</div>

			<div class="desc row">
				<textarea name="description"><%= listing.description %></textarea>
			</div>
		</form>
		<form id='biddingForm' action="/listings/<%= listing._id %>">
			<div class='row timer-row'>
				<div class="flex-across">
					<button id='save-edits' class='btn btn-primary'>Save Edits</button>
					<button id='cancel-edits' class='btn btn-light'>Cancel</button></a>
					<div id="border" class="bid-timer">
						<div id="countdown" class="big hspace"></div>
						<label for="newBid">Your bid: </label>
						<input type='text' class='col' id='newBid' name='newBid' min=0 placeholder="For reference" />
					</div>
					<button id='submitBid' type='submit'><i class="fa fa-gavel fa-3x" ></i></button>
				</div>
			</div>
		</form>
	</div>
</div>

<%- include("partials/footer") %>
<script>
	let listID = <%- JSON.stringify(listing._id) %>;
	console.log(listID);
</script>
<!-- <script src="/js/countdown.js"></script> -->
<script src="/js/gallery.js"></script>
<script src="/js/edit.js"></script>
</body>
</html>
